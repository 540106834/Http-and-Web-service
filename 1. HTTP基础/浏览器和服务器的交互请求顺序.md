# **浏览器访问一个网页时的典型请求顺序**



### 1. **用户输入网址/点击链接**

浏览器向服务器发起 **HTTP/HTTPS 请求**。

```
浏览器 --> 服务器 : GET /
```

- 这是访问主页 `/` 的请求。
- 服务器返回主页 HTML 内容（200 OK）。

```
服务器 --> 浏览器 : 200 OK + HTML 内容
```

```
10.10.10.1 - - [12/Dec/2025:23:45:35 +0000] "GET / HTTP/1.1" 200 31 "-" "Mozilla/5.0 ..."
10.10.10.1 - - [12/Dec/2025:23:45:35 +0000] "GET /favicon.ico HTTP/1.1" 200 31 "https://10.10.10.104/" "Mozilla/5.0 ..."

1. 第一行
请求路径：/（主页）
响应状态：200
浏览器第一次访问网页，服务器返回主页内容。

2. 第二行
请求路径：/favicon.ico（网站图标）
响应状态：200
浏览器在加载网页后，会自动请求网站的 favicon 图标，这也是一条新的请求，所以单独生成一行日志。

Referer 显示 https://10.10.10.104/，说明这是在主页加载完后发出的请求。
一行日志 = 一次 HTTP/HTTPS 请求
浏览器访问网页时，通常至少会发两个请求：主页 / + favicon /favicon.ico
如果页面里有 CSS、JS、图片，还会出现更多行日志。
```



### 2. **浏览器解析 HTML**

浏览器收到 HTML 后开始解析，发现页面里有：

- CSS 文件
- JS 文件
- 图片
- favicon.ico

浏览器会为每个资源发起独立请求。

```
浏览器 --> 服务器 : GET /style.css
浏览器 --> 服务器 : GET /script.js
浏览器 --> 服务器 : GET /image.png
浏览器 --> 服务器 : GET /favicon.ico
```

- 每个请求都是单独的 HTTP/HTTPS 请求。
- 服务器逐一返回对应内容。

```
服务器 --> 浏览器 : 200 OK + 对应资源
```

------

### 3. **浏览器渲染页面**

- 浏览器在拿到 CSS、JS、图片后渲染页面。
- JS 可能触发新的 AJAX/Fetch 请求，继续生成新的 HTTP 请求。

```
浏览器 --> 服务器 : GET /api/data
服务器 --> 浏览器 : 200 OK + JSON
```

------

### 4. **特殊情况**

- 如果 HTTP → HTTPS 自动跳转：

```
浏览器 --> 服务器 : GET http://example.com/
服务器 --> 浏览器 : 301 Moved Permanently
浏览器 --> 服务器 : GET https://example.com/
```

- 如果页面有 HSTS或者缓存了301/302重定向，浏览器直接发 HTTPS 请求，不经过 301/302

- ```
  HSTS（HTTP Strict Transport Security）
  
  **目的**：强制浏览器使用 HTTPS，防止 HTTP 降级攻击。
  **存储位置**：浏览器内部的 HSTS 列表（不是普通缓存）
  **触发条件**：服务器通过 HTTPS 响应头发送 `Strict-Transport-Security`。
  **作用**：
    1. 浏览器记住这个域名必须使用 HTTPS。
    2. 用户即使输入 `http://`，浏览器也会自动升级到 `https://`。
    3. 在 HSTS 有效期内（由 `max-age` 决定），浏览器不会再尝试 HTTP。
  示例响应头：
  Strict-Transport-Security: max-age=31536000; includeSubDomains
  特点：
    * 不是页面缓存，也不缓存 HTML/JS/CSS 文件。
    * 主要保护通信安全。
   
   
  浏览器缓存（Cache）
  **目的**：加速页面加载，减少重复请求。
  **存储位置**：浏览器缓存（内存/磁盘）
  **触发条件**：
  * HTTP 响应头中包含：
      Cache-Control: max-age=3600
      Expires: Wed, 13 Dec 2025 23:59:59 GMT
  **作用**：
    1. 浏览器可以直接使用本地缓存内容，不再请求服务器。
    2. 可以缓存 HTML、CSS、JS、图片、字体等资源。
  **特点**：
   * 主要提升性能，减少网络流量。
   * 与 HSTS 无直接关系，但同时存在时，HSTS 先生效（安全规则），缓存只是决定是否再次请求服务器。
  
  HSTS 与缓存的关系
  
  | 特性     | HSTS                            | 浏览器缓存                            |
  | ------ | ------------------------------- | -------------------------------- |
  | 目的     | 强制 HTTPS                        | 提升加载速度                           |
  | 存储内容   | 域名及 max-age                     | 文件内容、资源                          |
  | 触发条件   | 服务器发送 Strict-Transport-Security | 服务器发送 Cache-Control / Expires    |
  | 是否影响请求 | 会改变 HTTP → HTTPS                | 决定是否发送请求或用本地缓存                   |
  | 生命周期   | 由 `max-age` 决定                  | 由 `Cache-Control` / `Expires` 决定 |
  
  **例子：**
  * 用户访问 `https://example.com`，服务器返回 HSTS 和 Cache-Control。
  * 下次访问：
    * HSTS 让浏览器即使输入 `http://example.com` 也直接用 HTTPS
    * Cache-Control 可能让浏览器直接使用本地缓存 HTML/图片而不发请求
  ```

  

------

### 总结规律

1. **一行日志 = 一次请求**
2. **浏览器请求顺序**：
   - HTML 页面 `/`
   - CSS/JS/图片
   - favicon.ico
   - AJAX / Fetch 请求
3. **每次请求都单独记录日志**，所以你看到的多行日志就是浏览器按顺序加载资源产生的。