

```
[dev@c66-push-api-64849b9d44-bdks9 ~]$ curl -v -XPOST bd-report-api.bigdata.svc.cluster.local 
* Host bd-report-api.bigdata.svc.cluster.local:80 was resolved.
* IPv6: (none)
* IPv4: 192.168.220.117
*   Trying 192.168.220.117:80...
* Connected to bd-report-api.bigdata.svc.cluster.local (192.168.220.117) port 80
> POST / HTTP/1.1
> Host: bd-report-api.bigdata.svc.cluster.local
> User-Agent: curl/8.5.0
> Accept: */*
> 
< HTTP/1.1 404 Not Found
< Connection: keep-alive
< Vary: Origin
< Vary: Access-Control-Request-Method
< Vary: Access-Control-Request-Headers
< Transfer-Encoding: chunked
< Content-Type: application/json
< guance_trace_id: 69393a56000000005b901038260cc441
< Date: Wed, 10 Dec 2025 09:16:06 GMT
< 
* Connection #0 to host bd-report-api.bigdata.svc.cluster.local left intact
{"timestamp":"2025-12-10 17:16:06","status":404,"error":"Not Found","path":"/"}
```

ä½ è¿™æ¡ `curl -v` çš„è¾“å‡ºå…¶å®å·²ç»æŠŠâ€œæ¡ˆå‘ç°åœºâ€äº¤ä»£å¾—éå¸¸æ¸…æ¥šäº†ï¼Œæˆ‘ä»¬æ¥åƒå‰¥æ´‹è‘±ä¸€æ ·ä¸€å±‚å±‚æ‹† ğŸ§…ã€‚

---

## ä¸€çœ¼çœ‹ç»“è®º

**ä½ çš„è¯·æ±‚å‘åˆ°äº†å¯¹çš„ Serviceï¼Œä½†æ‰“åˆ°äº†â€œæ²¡æœ‰è¢«ä»»ä½•è·¯ç”±å¤„ç†çš„è·¯å¾„ `/`â€ï¼Œæ‰€ä»¥åç«¯è¿”å›äº† 404ã€‚**

> DNS âœ”
> Service è¿é€š âœ”
> Pod èƒ½æ”¶åˆ°è¯·æ±‚ âœ”
> HTTP è·¯ç”±æœªåŒ¹é… âŒ â†’ è¿”å› `{ "status": 404, "path": "/" }`

---

## é€è¡Œè§£å‰–ä½ è¿™æ¬¡è¯·æ±‚

### 1. DNS è§£æ âœ…

```bash
* Host bd-report-api.bigdata.svc.cluster.local:80 was resolved.
* IPv4: 192.168.220.117
```

è¯´æ˜ï¼š

* K8s å†…éƒ¨ DNS ç”Ÿæ•ˆ
* åŸŸåè§£æåˆ° **ClusterIPï¼š192.168.220.117**
* è¿™æ˜¯ä½ è¿™ä¸ª Service çš„è™šæ‹Ÿ IP

---

### 2. TCP è¿æ¥ âœ…

```bash
*   Trying 192.168.220.117:80...
* Connected to ...
```

è¯´æ˜ï¼š

* kube-proxy è½¬å‘è¡¨å·¥ä½œæ­£å¸¸
* Service â†’ Endpoint â†’ Pod é“¾è·¯æ²¡é—®é¢˜

---

### 3. è¯·æ±‚å†…å®¹

```http
> POST / HTTP/1.1
> Host: bd-report-api.bigdata.svc.cluster.local
```

å…³é”®ç‚¹ï¼š

* ä½ è¯·æ±‚çš„ **è·¯å¾„æ˜¯ï¼š`/`**
* æ–¹æ³•æ˜¯ `POST`

---

### 4. æœåŠ¡è¿”å›

```http
< HTTP/1.1 404 Not Found
< Content-Type: application/json
...
{"timestamp":"2025-12-10 17:16:06","status":404,"error":"Not Found","path":"/"}
```

è¿™ä¸ªè¿”å›æ ¼å¼éå¸¸â€œSpring Boot é£æ ¼â€ï¼Œå…¸å‹çš„ï¼š

* è¯·æ±‚å·²ç»è¿›å…¥åˆ° Web åº”ç”¨
* ä½† **æ²¡æœ‰ä»»ä½• Controller / Router èƒ½å¤„ç† `/` + `POST`**

---

## âš– æ‰€ä»¥é—®é¢˜æ ¹å› æ˜¯

> âœ… Service å’Œç½‘ç»œæ²¡é—®é¢˜
> âŒ è®¿é—®çš„ **è·¯å¾„ä¸å¯¹**

ä½ çš„åç«¯æœåŠ¡**å¤§æ¦‚ç‡æ ¹æœ¬æ²¡æœ‰å®šä¹‰ `/` è¿™ä¸ªæ¥å£**ã€‚

---

## æ­£ç¡®æ’æŸ¥å§¿åŠ¿

### âœ… 1. æŸ¥çœ‹ Service æš´éœ²äº†å“ªäº›ç«¯å£

```bash
kubectl get svc -n bigdata bd-report-api -o yaml
```

é‡ç‚¹çœ‹ï¼š

```yaml
spec:
  ports:
    - port: 80
      targetPort: 8080   # å®¹å™¨å†…éƒ¨ç«¯å£
```

---

### âœ… 2. æ‰¾ Podï¼ŒæŸ¥çœ‹çœŸæ­£çš„æ¥å£

```bash
kubectl get ep -n bigdata bd-report-api
```

ç„¶åè¿›å…¥ä»»ä¸€ Podï¼š

```bash
kubectl exec -it <pod> -n bigdata -- sh
```

---

### âœ… 3. æŸ¥è¯¢ Spring Boot æ¥å£åˆ—è¡¨

æœ€ç®€å•ç›´æ¥çš„å‡ ç§æ–¹å¼ï¼š

#### å¦‚æœæœ‰ actuatorï¼š

```bash
curl http://localhost:8080/actuator/mappings
```

---

#### æˆ– grep æ—¥å¿—ï¼š

```bash
grep -R "RequestMapping" logs/
```

---

#### æˆ–æ‰«ä¸€ä¸‹æ¥å£è¯•è¯•

```bash
curl http://bd-report-api.bigdata.svc.cluster.local/health
curl http://bd-report-api.bigdata.svc.cluster.local/api
curl http://bd-report-api.bigdata.svc.cluster.local/report
```

---

## âœ… æ­£ç¡®ç¤ºä¾‹

å‡è®¾ä½ çš„æ¥å£æ˜¯ï¼š

```java
@PostMapping("/report")
```

é‚£ä¹ˆæ­£ç¡®è°ƒç”¨æ–¹å¼æ˜¯ï¼š

```bash
curl -X POST \
  http://bd-report-api.bigdata.svc.cluster.local/report \
  -H "Content-Type: application/json" \
  -d '{"foo":"bar"}'
```

---

## ä¸ºä»€ä¹ˆä¸æ˜¯ 503 / 502ï¼Ÿ

å¾ˆå¤šäººä»¥ä¸º service é…é”™ä¼š 404ï¼Œå…¶å®å®Œå…¨ç›¸åï¼š

| é”™è¯¯ç                               | çœŸæ­£å«ä¹‰           |
| -------------------------------- | -------------- |
| **404**                          | æœåŠ¡æ”¶åˆ°è¯·æ±‚ï¼Œä½†è·¯ç”±æ²¡åŒ¹é…  |
| **503 / 502**                    | è¯·æ±‚æ ¹æœ¬æ²¡èƒ½æ‰“åˆ°åç«¯ Pod |
| **Connection refused / timeout** | ç½‘ç»œæˆ–ç«¯å£å±‚é¢å¤±è´¥      |
| **NXDOMAIN**                     | DNS æ ¹æœ¬æ²¡è§£æåˆ°     |

ä½ è¿™é‡Œæ˜¯æœ€å¥åº·çš„ä¸€ç§å¤±è´¥æ¨¡å¼ï¼š

âœ… è¯·æ±‚å®Œå…¨èµ°é€š
âŒ åªæ˜¯èµ°é”™é—¨

---

## æœ€å°è¯Šæ–­æ€»ç»“ ğŸ§­

```text
curl -> Cluster DNS -> Service ClusterIP -> Endpoint -> Pod -> Spring MVC

            âœ…               âœ…              âœ…              âœ…
                                                   |
                                                   âŒ
                                           æ²¡æœ‰åŒ¹é… "/"
```

---

## ä¸€å¥è¯ç»“è®º

> Service æ²¡é”™ï¼Œç½‘ç»œæ²¡é”™ï¼ŒPod æ²¡é—®é¢˜ï¼Œ
> **é”™çš„æ˜¯ï¼šä½  POST äº†ä¸€ä¸ªåç«¯æ²¡æœ‰å®ç°çš„ `/` è·¯å¾„ã€‚**

---

## å¦‚æœä½ æ„¿æ„

ä½ è´´ä¸€ä¸‹ï¼š

```bash
kubectl get svc -n bigdata bd-report-api -o yaml
```

å’Œ

```bash
kubectl logs -n bigdata <ä»»æ„ä¸€ä¸ªbd-report-api-pod>
```

æˆ‘å¯ä»¥å¸®ä½ **æŠŠçœŸå®æ¥å£è·¯å¾„ç›´æ¥æ‰’å‡ºæ¥**ï¼Œç»™ä½ ä¸€æ¡â€œå¿… 200 çš„ curlâ€ã€‚ ğŸ§™â€â™‚ï¸
